10 ' Refactored with MSX Basic Dignified
20 ' CHANGE GRAPH KIT
30 ' v1.4
40 ' Edit uncompressed graphics on MSX binary files on disk
50 ' NEW
60 '   ML Routines
70 '     quicly clear the scan area
80 '     show and erase window requester
90 '     erese and invert the mini preview
100 '     refresh the edit area with the mini preview data
110 '   Faster save using the mini preview data
120 '   Multi purpose window requester
130 '   Edit screen mini preview with independent colors
140 '   No more save, was not needed. P key now exits
150 '   File always closed on exit, new, errors or break
160 '   On Stop handling of break
170 '   Better error report (portuguese and english only)
180 '
190 ' Copyright (1984 - 2019) - Fred Rique (farique)
200 ' https://github.com/farique1/Change-Graph-Kit
210 '
220 ON STOP GOSUB 4760:STOP ON
230 ON ERROR GOTO 4690
240 ZA=0
250 SCREEN 0:COLOR 15,1,1:WIDTH 40:KEY OFF
260 DEFINT A-Z
270 DIM YZ(20,2)
280 DEF FN ZZ(X)=ABS(X MOD 16+16) MOD 16
290 ZY=1:ZX=15:ZW=2:ZV=6:ZU=2:ZT=1
300 ZS=0:ZR=0:ZQ=0:ZP=0
310 ZW$="" ' leave blank to enable file request
320 ZV$=".bin" ' leave blank to all
330 IF ZV$="" THEN ZV$=".*"
340 IF ZW$<>"" THEN GOTO 960
350 ' {insert_disk}
360 CLS
370 ZA=1
380 LOCATE 14,8:PRINT "Insert disk"
390 LOCATE 11,10:PRINT "and press any key"
400 A$=INKEY$:IF A$="" GOTO 400
410 CLS
420 FILES "*"+ZV$
430 PRINT:PRINT
440 PRINT ":Load":PRINT ":ARROWS choose:ENTER select:SPACE type";
450 FOR F=0 TO 24
460 YY=0+40*F
470 IF CHR$(VPEEK(YY))=":" THEN YX=F-1
480 NEXT
490 X=12:Y=0
500 YY=X+40*Y
510 GOSUB 760
520 ' {keys}
530 A$=INKEY$
540 LOCATE X,Y:PRINT "<"
550 LOCATE X,Y:PRINT " "
560 IF A$="" THEN 520
570 LOCATE X,Y:PRINT " "
580 PX=X:PY=Y
590 IF A$=CHR$(&H1C) THEN X=X+13:GOSUB 680
600 IF A$=CHR$(&H1D) THEN X=X-13:GOSUB 680
610 IF A$=CHR$(&H1E) THEN Y=Y-1:GOSUB 680
620 IF A$=CHR$(&H1F) THEN Y=Y+1:GOSUB 680
630 IF A$=CHR$(&H0D) THEN GOSUB 930
640 IF A$=" " THEN GOTO 880
650 LOCATE X,Y:PRINT "<"
660 GOSUB 760
670 GOTO 520
680 ' {move_cursor_files}
690 IF X>=39 THEN X=12
700 IF X<=0 THEN X=38
710 IF Y<=0 THEN Y=0
720 IF Y>=24 THEN Y=24
730 YY=X+40*Y
740 IF VPEEK(YY-12)=32 THEN X=PX:Y=PY:YY=X+40*Y
750 RETURN
760 ' {show_content}
770 YW=0
780 ZW$=""
790 ZU$=""
800 LOCATE 6,YX:PRINT "            "
810 FOR F=YY-12 TO YY-1
820 ZU$=CHR$(VPEEK(F))
830 ZW$=ZW$+ZU$
840 LOCATE 6+YW,YX:PRINT ZU$
850 YW=YW+1
860 NEXT
870 RETURN
880 ' {type_name}
890 ZA=2
900 LOCATE 6,YX:? "            "
910 LOCATE 6,YX:LINE INPUT ZW$
920 IF ZW$="" THEN GOSUB 760:GOTO 520
930 ' {continue}
940 LOCATE 39,YX+1:PRINT
950 FILES ZW$
960 ' {inicializacao}
970 CLS:SCREEN 1:WIDTH 32
980 VPOKE 6914,0:VPOKE 6918,1:VPOKE 6922,2:VPOKE 6926,3:VPOKE 6930,2
990 LOCATE 10,11:PRINT "INITIALIZING"
1000 LOCATE 10,13:PRINT "    GAME    "
1010 OPEN ZW$ AS #1 LEN=1
1020 FIELD #1,1 AS ZZ$
1030 GET #1,3:ZY$=ZZ$:GET #1,2:ZX$=ZZ$:ZO=(ASC(ZY$)*256+ASC(ZX$))-65536!
1040 GET #1,5:ZY$=ZZ$:GET #1,4:ZX$=ZZ$:ZN=(ASC(ZY$)*256+ASC(ZX$))-65536!
1050 YV=ZN-ZO
1060 YU=&H1:YT=8:YS=800:ZS=1
1070 YR=YU:YQ=16:YP=23:YO=8
1080 LOCATE 10,13:PRINT "   COLORS   "
1090 GOSUB 2240
1100 LOCATE 10,13:PRINT " ML SUPPORT "
1110 YN=&HD000
1120 FOR F=0 TO 145:READ A$:LOCATE 14,15:PRINT 145-F:POKE YN+F,VAL("&h"+A$):NEXT:LOCATE 14,15:PRINT "   "
1130 DEFUSR0=YN+&H08 ' fill VRAM 		0=pattern: 1,2=start: 3,4=length
1140 DEFUSR1=YN+&H0B ' invert VRAM 		0=length: 1,2=start
1150 DEFUSR2=YN+&H0E ' copy to VRAM 		0,1=length: 2,3=VRAM
1160 DEFUSR3=YN+&H11 ' copy from VRAM 	0,1=length: 2,3=VRAM
1170 DEFUSR4=YN+&H14 ' populate edit 	0=colunms: 1=lines
1180 POKE YN+0,0:POKE YN+1,&H00:POKE YN+2,&H04:POKE YN+3,&H20:POKE YN+4,&H03:A=USR0(0)
1190 LOCATE 10,13:PRINT " ERROR MSGS "
1200 DIM YM(36)
1210 ' Using the time format in ROM to determine language
1220 IF (PEEK(&H2B) AND 112)=32 THEN RESTORE 5650 ELSE RESTORE 5700
1230 FOR F=1 TO 36:READ A:YM(F)=A:NEXT
1240 RESTORE 5760
1250 LOCATE 10,13:PRINT "   SHAPES   "
1260 LOCATE 15,15:PRINT "07"
1270 FOR F=0 TO 23:READ A:VPOKE &H0008+F,A:NEXT:LOCATE 15,15:PRINT "06"
1280 FOR F=0 TO 31:VPOKE &H0040+F,0:NEXT:LOCATE 15,15:PRINT "05"
1290 FOR F=0 TO 7:READ A:VPOKE &H0080+F,A:NEXT:LOCATE 15,15:PRINT "04"
1300 FOR F=0 TO 7:READ A:VPOKE &H00F8+F,A:NEXT:LOCATE 15,15:PRINT "03"
1310 FOR F=0 TO 7:READ A:VPOKE &H0720+F,A:NEXT:LOCATE 15,15:PRINT "02"
1320 FOR F=0 TO 23:READ A:VPOKE &H0740+F,A:NEXT:LOCATE 15,15:PRINT "01"
1330 FOR F=0 TO 31:READ A:VPOKE &H3800+F,A:NEXT:LOCATE 15,15:PRINT "00"
1340 ' {search_screen}
1350 CLS
1360 LOCATE 0,0:PRINT "        CHANGE GRAPH KIT        "
1370 LOCATE 1,2:PRINT "XWWWWWWWWWWY"
1380 LOCATE 1,3:PRINT "VÄäîû®≤º∆–⁄V"
1390 LOCATE 1,4:PRINT "VÅãïü©≥Ω«—€V"
1400 LOCATE 1,5:PRINT "VÇåñ†™¥æ»“‹V"
1410 LOCATE 1,6:PRINT "VÉçó°´µø…”›V"
1420 LOCATE 1,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
1430 LOCATE 1,8:PRINT "VÖèô£≠∑¡À’ﬂV"
1440 LOCATE 1,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
1450 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
1460 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
1470 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
1480 LOCATE 1,13:PRINT "ZWWWWWWWWWW["
1490 LOCATE 3,15:PRINT "Srt# End#"
1500 LOCATE 1,17:PRINT "C"
1510 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YR)),"0")+HEX$(YR)
1520 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YR+( YO-1))),"0")+HEX$(YR+( YO-1))
1530 LOCATE 1,19:PRINT "R"
1540 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(YU)),"0")+HEX$(YU)
1550 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(YU+799)),"0")+HEX$(YU+799)
1560 LOCATE 1,21:PRINT "G"
1570 LOCATE 3,21:PRINT STRING$(4-LEN(HEX$(1)),"0")+HEX$(1)
1580 LOCATE 8,21:PRINT STRING$(4-LEN(HEX$(YV)),"0")+HEX$(YV)
1590 LOCATE 13,2:PRINT "XWWWWWWWRWWWWWWWWY"
1600 LOCATE 13,3:PRINT "VCm #  "+RIGHT$(STR$(YT),1)+"VEditing V"
1610 LOCATE 13,4:PRINT "VRm #"+RIGHT$(HEX$(YS),3)+"V"+LEFT$(ZW$,8)+"V"
1620 LOCATE 13,5:PRINT "ZWWWWWWWQWWWWWWWW["
1630 ' {keys_page_start}
1640 ON ZP GOTO 1720
1650 LOCATE 13,7:PRINT "VÍVMove VËVEdit   "
1660 LOCATE 13,9:PRINT "VÈVStep VDVSize   "
1670 LOCATE 13,11:PRINT "VBVClearVRVRefresh"
1680 LOCATE 13,13:PRINT "VFVFreeze/Unfreeze"
1690 LOCATE 13,15:PRINT "VEVExplode/Ovrview"
1700 LOCATE 13,17:PRINT "                  "
1710 GOTO 1790
1720 ' {keys_page_2}
1730 LOCATE 13,7:PRINT "VNVNew  VPVExit  "
1740 LOCATE 13,9:PRINT "VQVPrev VWVNext   "
1750 LOCATE 13,11:PRINT "VAVP 4x VSVN 4x   "
1760 LOCATE 13,13:PRINT "VZVSrtVXVMidVCVEnd"
1770 LOCATE 13,15:PRINT "V1-8VChange Colors"
1780 LOCATE 13,17:PRINT "                  "
1790 ' {keys_page_end}
1800 LOCATE 13,19:PRINT "      VVVMore Keys" ' VHVHelp
1810 LOCATE 13,21:PRINT "ABBBBBBBBBBBBBBBBC"
1820 GOSUB 2770:REM if haltScan=1 then locate 2,2:print "WWFREEZEWW"
1830 IF ZR=1 THEN LOCATE 2,13:PRINT "WOverviewW"
1840 YL=YP+(YO-2):YK=0
1850 IF YP+(YO-2)>101 THEN YK=8:YL=23+(YP+(YO-2))-103
1860 IF YQ+YK>95 THEN YL=200
1870 VPOKE 6912,YP-1:VPOKE 6913,YQ
1880 VPOKE 6916,YL+1:VPOKE 6917,YK+YQ
1890 VPOKE 6920,167:VPOKE 6921,142*YU/YV+105
1900 VPOKE 6928,167:VPOKE 6929,(142*YU/YV)+105+(100800!/YV)
1910 IF ZQ=1 THEN ZQ=0:GOSUB 2590
1920 ' {read_keyboard_main}
1930 A$=INKEY$
1940 IF A$="1" THEN ZY=ZY-1:GOSUB 2240
1950 IF A$="2" THEN ZY=ZY+1:GOSUB 2240
1960 IF A$="3" THEN ZX=ZX-1:GOSUB 2240
1970 IF A$="4" THEN ZX=ZX+1:GOSUB 2240
1980 IF A$="5" THEN ZW=ZW-1:GOSUB 2240
1990 IF A$="6" THEN ZW=ZW+1:GOSUB 2240
2000 IF A$="7" THEN ZV=ZV-1:GOSUB 2240
2010 IF A$="8" THEN ZV=ZV+1:GOSUB 2240
2020 IF A$=CHR$(&H1C) AND YQ+8<95 THEN YQ=YQ+8:YR=YR+80:GOSUB 2400
2030 IF A$=CHR$(&H1D) AND YQ-8>15 THEN YQ=YQ-8:YR=YR-80:GOSUB 2400
2040 IF A$=CHR$(&H1E) AND YP-YT>22 THEN YP=YP-YT:YR=YR-YT:GOSUB 2400
2050 IF A$=CHR$(&H1F) AND YP+YT<103 THEN YP=YP+YT:YR=YR+YT:GOSUB 2400
2060 IF A$="P" THEN GOSUB 4600:CLOSE:CLEAR:SCREEN 0:WIDTH 40:COLOR 15,5,5:NEW
2070 IF A$=" " THEN GOSUB 2810
2080 IF A$="D" THEN GOSUB 2500
2090 IF A$=CHR$(13) THEN GOTO 2860
2100 IF A$="E" THEN GOTO 3840
2110 IF A$="R" THEN ZM=0:GOSUB 2710
2120 IF A$="F" THEN ZM=0:ZS=ABS(ZS-1):IF ZS=1 THEN GOSUB 2770:ELSE:GOSUB 2710
2130 IF A$="Q" THEN ZM=YR-YU:YU=YU-YS:GOSUB 2590
2140 IF A$="W" THEN ZM=YR-YU:YU=YU+YS:GOSUB 2590
2150 IF A$="A" THEN ZM=YR-YU:YU=YU-YS*4:GOSUB 2590
2160 IF A$="S" THEN ZM=YR-YU:YU=YU+YS*4:GOSUB 2590
2170 IF A$="Z" THEN ZM=YR-YU:YU=&H01:GOSUB 2590
2180 IF A$="X" THEN ZM=YR-YU:YU=(YV/2)-400:GOSUB 2590
2190 IF A$="C" THEN ZM=YR-YU:YU=YV-800:GOSUB 2590
2200 IF A$="N" THEN GOSUB 4600:RUN
2210 IF A$="B" THEN POKE YN+0,0:POKE YN+1,&H00:POKE YN+2,&H04:POKE YN+3,&H20:POKE YN+4,&H03:A=USR0(0)
2220 IF A$="V" THEN ZP=ABS(ZP-1):GOTO 1630
2230 GOTO 1920
2240 ' {set_color}
2250 ZY=FN ZZ(ZY)
2260 ZX=FN ZZ(ZX)
2270 ZW=FN ZZ(ZW)
2280 ZV=FN ZZ(ZV)
2290 ZU=FN ZZ(ZW)
2300 ZT=FN ZZ(ZY)
2310 COLOR ZX,ZY,ZY
2320 VPOKE 8194,ZV*16+ZY
2330 VPOKE 8195,ZV*16+ZY
2340 VPOKE 8192,ZV*16+ZW
2350 VPOKE 8193,ZW*16+ZY
2360 VPOKE 6915,ZX:VPOKE 6919,ZX
2370 VPOKE 6923,ZX:VPOKE 6927,ZX:VPOKE 6931,ZX
2380 FOR F=0 TO 12:VPOKE 8208+F,ZW*16+ZY:NEXT
2390 RETURN
2400 ' {move_scan_sprite}
2410 YL=YP+( YO-2):YK=0
2420 IF YP+( YO-2)>101 THEN YK=8:YL=23+(YP+( YO-2))-103
2430 IF YQ+YK>95 THEN YL=200
2440 VPOKE 6912,YP-1:VPOKE 6913,YQ
2450 VPOKE 6916,YL+1:VPOKE 6917,YQ+YK
2460 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YR)),"0")+HEX$(YR)
2470 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YR+( YO-1))),"0")+HEX$(YR+( YO-1))
2480 RETURN
2490 RETURN
2500 ' {change_sprite_size}
2510 IF YO=8 THEN YO=32 ELSE YO=8
2520 YL=YP+(YO-2):YK=0
2530 IF YP+(YO-2)>101 THEN YK=8:YL=23+(YP+(YO-2))-103
2540 IF YQ+YK>95 THEN YL=200
2550 VPOKE 6916,YL+1:VPOKE 6917,YQ+YK
2560 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YR)),"0")+HEX$(YR)
2570 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YR+( YO-1))),"0")+HEX$(YR+( YO-1))
2580 RETURN
2590 ' {update_memory_position}
2600 IF YU<&H1 THEN YU=&H1
2610 IF YU+800>YV THEN YU=YV-800
2620 YR=YU+ZM
2630 VPOKE 6920,167:VPOKE 6921,142*YU/YV+105
2640 VPOKE 6928,167:VPOKE 6929,(142*YU/YV)+105+(100800!/YV)
2650 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YR)),"0")+HEX$(YR)
2660 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YR+7)),"0")+HEX$(YR+7)
2670 LOCATE 3,19:PRINT STRING$(4-LEN(HEX$(YU)),"0")+HEX$(YU)
2680 LOCATE 8,19:PRINT STRING$(4-LEN(HEX$(YU+799)),"0")+HEX$(YU+799)
2690 IF ZS=0 THEN 2710
2700 RETURN
2710 ' {scan}
2720 ZR=0
2730 LOCATE 2,2:PRINT "WWWSCANWWW"
2740 LOCATE 2,13:PRINT "WVÈVStopWW"
2750 FOR F=YU TO YU+799
2760 VPOKE 1024-YU+F,VPEEK(1024-YU+F) XOR 255:GET #1,F:A$=ZZ$:VPOKE 1024-YU+F,ASC(A$):IF INKEY$=" " THEN 2770 ELSE NEXT
2770 ' {end_scan}
2780 IF ZS=1 THEN LOCATE 2,2:PRINT "WWFREEZEWW" ELSE LOCATE 2,2:PRINT "WWWWWWWWWW"
2790 LOCATE 2,13:PRINT "WWWWWWWWWW"
2800 RETURN
2810 ' {change_movement_step}
2820 IF YT=8 THEN YT=1 ELSE YT=8
2830 IF YS=800 THEN YS=400 ELSE YS=800
2840 LOCATE 20,3:PRINT RIGHT$(HEX$(YT),1):LOCATE 18,4:PRINT RIGHT$(HEX$(YS),3)
2850 RETURN
2860 ' {edit_screen}
2870 CLS
2880 VPOKE 6920,200:VPOKE 6928,200
2890 POKE YN+0,&H00:POKE YN+1,&H40:POKE YN+2,&H00:POKE YN+3,&H20:POKE YN+4,&H00:A=USR0(0)
2900 LOCATE 0,0:PRINT "        CHANGE GRAPH KIT        "
2910 LOCATE 1,2:PRINT "XWWWWWWWWWWY"
2920 LOCATE 1,3:PRINT "VÄäîû®≤º∆–⁄V"
2930 LOCATE 1,4:PRINT "VÅãïü©≥Ω«—€V"
2940 LOCATE 1,5:PRINT "VÇåñ†™¥æ»“‹V"
2950 LOCATE 1,6:PRINT "VÉçó°´µø…”›V"
2960 LOCATE 1,7:PRINT "VÑéò¢¨∂¿ ‘ﬁV"
2970 LOCATE 1,8:PRINT "VÖèô£≠∑¡À’ﬂV"
2980 LOCATE 1,9:PRINT "VÜêö§Æ∏¬Ã÷‡V"
2990 LOCATE 1,10:PRINT "Váëõ•Øπ√Õ◊·V"
3000 LOCATE 1,11:PRINT "Vàíú¶∞∫ƒŒÿ‚V"
3010 LOCATE 1,12:PRINT "Vâìùß±ª≈œŸ„V"
3020 LOCATE 1,13:PRINT "ZWWWWWWWWWW["
3030 LOCATE 3,15:PRINT "Srt# End#"
3040 LOCATE 1,17:PRINT "C"
3050 LOCATE 3,17:PRINT STRING$(4-LEN(HEX$(YR)),"0")+HEX$(YR)
3060 LOCATE 8,17:PRINT STRING$(4-LEN(HEX$(YR+( YO-1))),"0")+HEX$(YR+( YO-1))
3070 LOCATE 1,19:PRINT "XWWRWWWWRWWY"
3080 LOCATE 1,20:PRINT "VHJVX  0V13V"
3090 LOCATE 1,21:PRINT "VIKVY  0V24V"
3100 LOCATE 1,22:PRINT "ZWWQWWWWQWW["
3110 LOCATE 14,2:PRINT "________________"
3120 LOCATE 14,3:PRINT "________________"
3130 LOCATE 14,4:PRINT "________________"
3140 LOCATE 14,5:PRINT "________________"
3150 LOCATE 14,6:PRINT "________________"
3160 LOCATE 14,7:PRINT "________________"
3170 LOCATE 14,8:PRINT "________________"
3180 LOCATE 14,9:PRINT "________________"
3190 LOCATE 14,10:PRINT "________________"
3200 LOCATE 14,11:PRINT "________________"
3210 LOCATE 14,12:PRINT "________________"
3220 LOCATE 14,13:PRINT "________________"
3230 LOCATE 14,14:PRINT "________________"
3240 LOCATE 14,15:PRINT "________________"
3250 LOCATE 14,16:PRINT "________________"
3260 LOCATE 14,17:PRINT "________________"
3270 LOCATE 13,19:PRINT "VEVErzVRVRldVTVInv"
3280 LOCATE 13,21:PRINT "VÈVTglVSVSavVËVBck"
3290 VPOKE 6924,15:VPOKE 6925,112
3300 YJ=0:YI=0:YH=0
3310 ' {fill_edit_area}
3320 ZK=YR+(YO-1) 'find formula to cap at gameLength to avoid next if
3330 IF ZK>YV-1 THEN ZK=YV-1
3340 IF YO=8 THEN ZL=7:ZJ=8:ZI=8:ZH=1:ELSE:ZL=15:ZJ=32:ZI=16:ZH=2
3350 IF YH=2 THEN POKE YN+0,&H00:POKE YN+1,&H40:POKE YN+2,&H00:POKE YN+3,ZJ:POKE YN+4,&H00:A=USR0(0)
3360 IF YH=1 THEN POKE YN+0,ZJ:POKE YN+1,&H40:POKE YN+2,&H00:A=USR1(0)
3370 IF YH=0 THEN FOR I=YR TO ZK:GET #1,I:VPOKE 1024-YU+I,VPEEK(1024-YU+I) XOR 255:A$=ZZ$:VPOKE &H0040+I-YR,ASC(A$):VPOKE 1024-YU+I,ASC(A$):NEXT
3380 POKE YN+0,ZH:POKE YN+1,ZI:A=USR4(0)
3390 ' {read_keyboard_edit}
3400 A$=INKEY$
3410 IF A$=CHR$(&H1C) AND YJ<ZL THEN YJ=YJ+1:GOSUB 3610
3420 IF A$=CHR$(&H1D) AND YJ>0 THEN YJ=YJ-1:GOSUB 3610
3430 IF A$=CHR$(&H1E) AND YI>0 THEN YI=YI-1:GOSUB 3610
3440 IF A$=CHR$(&H1F) AND YI<ZL THEN YI=YI+1:GOSUB 3610
3450 IF A$="E" THEN YH=2:GOTO 3310
3460 IF A$="R" THEN YH=0:GOTO 3310
3470 IF A$="T" THEN YH=1:GOTO 3310
3480 IF A$=" " THEN GOSUB 3650
3490 IF A$="S" THEN GOSUB 3720
3500 IF A$="1" THEN ZU=ZU-1:GOSUB 3560
3510 IF A$="2" THEN ZU=ZU+1:GOSUB 3560
3520 IF A$="3" THEN ZT=ZT-1:GOSUB 3560
3530 IF A$="4" THEN ZT=ZT+1:GOSUB 3560
3540 IF A$=CHR$(13) THEN VPOKE 6924,200:GOTO 1340
3550 GOTO 3390
3560 ' {set_minipreview_color}
3570 ZU=FN ZZ(ZU)
3580 ZT=FN ZZ(ZT)
3590 VPOKE 8193,ZU*16+ZT
3600 RETURN
3610 ' {move_cursor}
3620 VPOKE 6924,15+(YI*8):VPOKE 6925,112+(YJ*8)
3630 LOCATE 7,20:PRINT USING "##";YJ:LOCATE 7,21:PRINT USING "##";YI
3640 RETURN
3650 ' {change_bit}
3660 YG=VPEEK ((YJ+14)+(YI+2)*32+6144)
3670 YG=(228+16)-YG
3680 VPOKE (YJ+14)+(YI+2)*32+6144,YG
3690 YF=YI:IF YJ>7 THEN YF=YI+16
3700 VPOKE &H0040+YF,2^(7-(YJ MOD 8)) XOR VPEEK(&H0040+YF)
3710 RETURN
3720 ' {save_drawing}
3730 ZK=YR+(YO-1) 'find formula to cap at gameLength to avoid next if
3740 IF ZK>YV-1 THEN ZK=YV-1
3750 FOR I=YR TO ZK
3760 YE=1024-YU+I
3770 YD=VPEEK(&H0040+I-YR)
3780 VPOKE YE,VPEEK(YE) XOR 255
3790 A$=CHR$(YD)
3800 LSET ZZ$=A$:PUT #1,I
3810 VPOKE SCAN_POS,YD
3820 NEXT
3830 RETURN
3840 ' {explode_screen}
3850 CLS
3860 LOCATE 0,0:PRINT "        CHANGE GRAPH KIT        "
3870 LOCATE 1,2:PRINT "XWWWWWWWWWWWWWWWWWWWY"
3880 LOCATE 1,3:PRINT "VÄ ä î û ® ≤ º ∆ – ⁄V"
3890 LOCATE 1,4:PRINT "V                   V"
3900 LOCATE 1,5:PRINT "VÅ ã ï ü © ≥ Ω « — €V"
3910 LOCATE 1,6:PRINT "V                   V"
3920 LOCATE 1,7:PRINT "VÇ å ñ † ™ ¥ æ » “ ‹V"
3930 LOCATE 1,8:PRINT "V                   V"
3940 LOCATE 1,9:PRINT "VÉ ç ó ° ´ µ ø … ” ›V"
3950 LOCATE 1,10:PRINT "V                   V"
3960 LOCATE 1,11:PRINT "VÑ é ò ¢ ¨ ∂ ¿   ‘ ﬁV"
3970 LOCATE 1,12:PRINT "V                   V"
3980 LOCATE 1,13:PRINT "VÖ è ô £ ≠ ∑ ¡ À ’ ﬂV"
3990 LOCATE 1,14:PRINT "V                   V"
4000 LOCATE 1,15:PRINT "VÜ ê ö § Æ ∏ ¬ Ã ÷ ‡V"
4010 LOCATE 1,16:PRINT "V                   V"
4020 LOCATE 1,17:PRINT "Vá ë õ • Ø π √ Õ ◊ ·V"
4030 LOCATE 1,18:PRINT "V                   V"
4040 LOCATE 1,19:PRINT "Và í ú ¶ ∞ ∫ ƒ Œ ÿ ‚V"
4050 LOCATE 1,20:PRINT "V                   V"
4060 LOCATE 1,21:PRINT "Vâ ì ù ß ± ª ≈ œ Ÿ „V"
4070 LOCATE 1,22:PRINT "ZWWWWWWWWWWWWWWWWWWW["
4080 LOCATE 23,03:PRINT "VOV Ovrw"
4090 LOCATE 23,21:PRINT "VEV Back"
4100 VPOKE 6912,200:VPOKE 6916,200
4110 VPOKE 6920,200:VPOKE 6928,200
4120 IF ZR=1 THEN GOSUB 4470
4130 ' {move_overview_sprite}
4140 IF ZR=0 THEN 4200
4150 VPOKE 6912,(ZF+1)*16+6:VPOKE 6913,(ZG+1)*16
4160 VPOKE 6916,(ZF+1)*16+14:VPOKE 6917,(ZG+1)*16
4170 ZB=(ZF*ZD)+(ZG*(ZD*10))
4180 LOCATE 27,13:PRINT STRING$(4-LEN(HEX$(ZB)),"0")+HEX$(ZB)
4190 LOCATE 27,15:PRINT STRING$(4-LEN(HEX$(ZB+799)),"0")+HEX$(ZB+799)
4200 ' {explode_keys}
4210 A$=INKEY$
4220 IF A$="O" THEN GOSUB 4300
4230 IF A$=CHR$(&H1C) AND ZG<9 THEN ZG=ZG+1:GOSUB 4130
4240 IF A$=CHR$(&H1D) AND ZG>0 THEN ZG=ZG-1:GOSUB 4130
4250 IF A$=CHR$(&H1F) AND ZF<9 THEN ZF=ZF+1:GOSUB 4130
4260 IF A$=CHR$(&H1E) AND ZF>0 THEN ZF=ZF-1:GOSUB 4130
4270 IF A$=CHR$(13) AND ZR=1 THEN YU=(ZF*ZD)+(ZG*(ZD*10)):ZQ=1:YR=YU:YQ=16:YP=23:IF YU+799>YV THEN YU=YV-799:YQ=16:YP=23:YR=YU:GOTO 1340 ELSE GOTO 1340
4280 IF A$="E" THEN GOTO 1340
4290 GOTO 4200
4300 ' {overview}
4310 ZE=0
4320 ZR=1
4330 ZD=(YV/100)
4340 ZC=(9*ZD)+(9*(ZD*10))+8
4350 LOCATE 2,2:PRINT "WWWWWWWSCANWWWWWWWW"
4360 LOCATE 2,22:PRINT "WWWWWVÈVStopWWWWWWW"
4370 FOR F=1 TO ZC STEP ZD
4380 FOR I=F TO F+7
4390 VPOKE 1024+ZE,VPEEK(1024+ZE) XOR 255
4400 GET #1,I
4410 A$=ZZ$
4420 VPOKE 1024+ZE,ASC(A$)
4430 IF INKEY$=" " THEN 4470
4440 ZE=ZE+1
4450 NEXT
4460 NEXT
4470 ' {end_overview}
4480 VPOKE 6912,(ZF+1)*16+6:VPOKE 6913,(ZG+1)*16
4490 VPOKE 6916,(ZF+1)*16+14:VPOKE 6917,(ZG+1)*16
4500 LOCATE 23,05:PRINT "VÍV Move"
4510 LOCATE 23,07:PRINT "VËV Go"
4520 LOCATE 23,11:PRINT "Region"
4530 ZB=(ZF*ZD)+(ZG*(ZD*10))
4540 LOCATE 23,13:PRINT "St# "+STRING$(4-LEN(HEX$(ZB)),"0")+HEX$(ZB)
4550 LOCATE 23,15:PRINT "Ed# "+STRING$(4-LEN(HEX$(ZB+799)),"0")+HEX$(ZB+799)
4560 LOCATE 02,2:PRINT "WWWWWWWWWWWWWWWWWWW"
4570 LOCATE 2,22:PRINT "WWWWWWWWWWWWWWWWWWW"
4580 RETURN
4590 END
4600 ' {window_requester}
4610 POKE YN+0,&H60:POKE YN+1,&H00:POKE YN+2,&H40:POKE YN+3,&H19:A=USR3(0)
4620 LOCATE 5,10:PRINT "XWWWWWWWWWWWWWWWWWWWY"
4630 LOCATE 5,11:PRINT "VAre you sure? (Y/N)V"
4640 LOCATE 5,12:PRINT "ZWWWWWWWWWWWWWWWWWWW[
4650 A$=INKEY$:IF A$<>"Y" AND A$<>"N" THEN 4650
4660 IF A$="Y" THEN RETURN
4670 POKE YN+0,&H60:POKE YN+1,&H00:POKE YN+2,&H40:POKE YN+3,&H19:A=USR2(0)
4680 RETURN 1920
4690 ' {error}
4700 IF (ERR=53 AND ZA=1) OR ERR=70 THEN GOTO 4790
4710 IF ERR=53 AND ZA=2 THEN GOTO 4870
4720 IF ERR=56 AND ZA=2 THEN ZA=3:GOTO 4870
4730 YC=ERR:IF YC>25 THEN YC=YC-24
4740 FOR F=YM(YC) TO YM(YC+1):PRINT CHR$(PEEK(&H3D75+F));:NEXT
4750 PRINT " at";ERL
4760 ' {stopped}
4770 CLOSE
4780 END
4790 ' {file_not_found}
4800 PRINT:PRINT "No files found"
4810 PRINT:PRINT "Press space to restart"
4820 A$=INKEY$:IF A$=" " THEN PRINT ELSE 4820
4830 ZA=0
4840 CLS
4850 RESUME 350
4860 ON ERROR GOTO 0
4870 ' {input_past_end}
4880 PRINT:PRINT
4890 IF ZA=2 THEN:PRINT ZW$;" not found" ELSE PRINT "Invalid name"
4900 PRINT:PRINT "Press space to restart"
4910 A$=INKEY$:IF A$=" " THEN PRINT ELSE 4910
4920 ZA=0
4930 RESUME 350
4940 ON ERROR GOTO 0
4950 ' ML Routines
4960 DATA 00,00,00,00
4970 DATA 00,00,00,00
4980 DATA C3,17,D0
4990 DATA C3,25,D0
5000 DATA C3,38,D0
5010 DATA C3,47,D0
5020 DATA C3,55,D0
5030 DATA 3A,00,D0
5040 DATA 2A,01,D0
5050 DATA ED,4B,03,D0
5060 DATA CD,56,00
5070 DATA C9
5080 DATA 3A,00,D0
5090 DATA 47
5100 DATA 2A,01,D0
5110 DATA CD,4A,00
5120 DATA EE,FF
5130 DATA CD,4D,00
5140 DATA 23
5150 DATA 10,F5
5160 DATA C9
5170 DATA ED,4B,00,D0
5180 DATA ED,5B,02,D0
5190 DATA 21,92,D0
5200 DATA CD,5C,00
5210 DATA C9
5220 DATA ED,4B,00,D0
5230 DATA 11,92,D0
5240 DATA 2A,02,D0
5250 DATA CD,59,00
5260 DATA C9
5270 DATA 11,40,00
5280 DATA 21,4E,18
5290 DATA 3A,00,D0
5300 DATA 47
5310 DATA C5
5320 DATA 3A,01,D0
5330 DATA 47
5340 DATA C5
5350 DATA E5
5360 DATA D5
5370 DATA E1
5380 DATA CD,4A,00
5390 DATA E5
5400 DATA D1
5410 DATA E1
5420 DATA 06,08
5430 DATA 17
5440 DATA F5
5450 DATA 38,1A
5460 DATA 3E,10
5470 DATA CD,4D,00
5480 DATA F1
5490 DATA 23
5500 DATA 10,F3
5510 DATA C1
5520 DATA 13
5530 DATA D5
5540 DATA 11,18,00
5550 DATA 19
5560 DATA D1
5570 DATA 10,DD
5580 DATA 21,56,18
5590 DATA C1
5600 DATA 10,D2
5610 DATA C9
5620 DATA 3E,E4
5630 DATA 18,E4
5640 ' Error Messages in ROM
5650 ' {portuguese_ROM}
5660 DATA 0,13,26,43,52,66,75,89,110,132,147
5670 DATA 164,178,192,210,223,239,253,271,287
5680 DATA 304,311,328,344,359,371,383,396,410
5690 DATA 429,444,459,475,501,520,531
5700 ' {english_ROM}
5710 DATA 0,17,30,51,63,85,94,108,130,153,173
5720 DATA 190,205,219,239,255,282,297,321,338
5730 DATA 351,361,382,400,416,437,452,467,483
5740 DATA 498,516,531
5750 ' Character Shapes
5760 ' {character_shapes}
5770 DATA 255,128,128,128,128,128,128,255
5780 DATA 255,0,0,0,0,0,0,255
5790 DATA 255,1,1,1,1,1,1,255
5800 DATA 255,129,129,129,129,129,129,255
5810 DATA 255,255,255,255,255,255,255,255
5820 DATA 0,126,126,126,126,126,126,0
5830 DATA 4,4,36,100,252,96,32,0
5840 DATA 0,0,219,154,82,211,0,0
5850 DATA 231,195,165,24,24,165,195,231
5860 ' Sprite Shapes
5870 DATA 255,129,0,0,0,0,0,0
5880 DATA 129,255,0,0,0,0,0,0
5890 DATA 0,128,128,128,128,128,128,0
5900 DATA 255,129,129,129,129,129,129,255
5910 ' Functions Not Used
5920 ' Create Character Block
5930 C=127
5940 FOR X=2 TO 11
5950 FOR Y=3 TO 12
5960 C=C+1:LOCATE X,Y:PRINT:PRINT CHR$(C)
5970 NEXT
5980 NEXT
5990 END
6000 ' Character Map
6010 FOR I=0 TO 255
6020 X=I MOD 32:Y=I\32
6030 C=I
6040 IF C<32 OR C=127 THEN C=32
6050 LOCATE X,Y:PRINT CHR$(C)
6060 LOCATE X,Y+10:PRINT CHR$(1)+CHR$(C)
6070 NEXT
6080 END
